<div class="grid">
    <!-- Título y descripción -->
    <div class="col-12">
        <div class="card">
            <div class="flex align-items-center justify-content-between mb-3">
                <div>
                    <h4 class="m-0 flex align-items-center gap-2">
                        <i class="pi pi-wrench text-primary"></i>
                        Tipos de Mantenimiento
                    </h4>
                    <p class="text-500 mt-1 mb-0">Gestione los tipos de mantenimiento: preventivo, correctivo, calibración, etc.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Estadísticas -->
    <div class="col-12 md:col-4">
        <div class="surface-card shadow-1 border-round p-3">
            <div class="flex align-items-center">
                <div class="bg-blue-100 border-circle p-3 mr-3">
                    <i class="pi pi-list text-blue-500 text-2xl"></i>
                </div>
                <div>
                    <span class="text-600 text-sm">Total Tipos</span>
                    <div class="text-900 font-bold text-2xl">{{ totalTipos }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-12 md:col-4">
        <div class="surface-card shadow-1 border-round p-3">
            <div class="flex align-items-center">
                <div class="bg-green-100 border-circle p-3 mr-3">
                    <i class="pi pi-check-circle text-green-500 text-2xl"></i>
                </div>
                <div>
                    <span class="text-600 text-sm">Activos</span>
                    <div class="text-900 font-bold text-2xl">{{ tiposActivos }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-12 md:col-4">
        <div class="surface-card shadow-1 border-round p-3">
            <div class="flex align-items-center">
                <div class="bg-red-100 border-circle p-3 mr-3">
                    <i class="pi pi-times-circle text-red-500 text-2xl"></i>
                </div>
                <div>
                    <span class="text-600 text-sm">Inactivos</span>
                    <div class="text-900 font-bold text-2xl">{{ tiposInactivos }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla principal -->
    <div class="col-12">
        <div class="card">
            <!-- Barra de acciones moderna -->
            <div class="surface-ground border-round p-3 mb-4">
                <div class="flex flex-column md:flex-row md:align-items-center md:justify-content-between gap-3">
                    <div class="flex gap-2">
                        <button pButton pRipple label="Nuevo Tipo" icon="pi pi-plus" 
                                class="p-button-success"
                                (click)="showCreateDialog()"></button>
                    </div>
                    
                    <span class="p-input-icon-left w-full md:w-auto">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" 
                               (input)="dt.filterGlobal($any($event.target).value, 'contains')" 
                               placeholder="Buscar tipo..." 
                               class="w-full md:w-20rem" />
                    </span>
                </div>
            </div>

            <!-- Tabla mejorada -->
            <p-table [value]="tipos" 
                     [loading]="loading" 
                     [paginator]="true" 
                     [rows]="10" 
                     [rowsPerPageOptions]="[10,20,30]"
                     [showCurrentPageReport]="true"
                     currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} tipos"
                     [globalFilterFields]="['nombre']" 
                     [rowHover]="true"
                     styleClass="p-datatable-sm"
                     #dt>

                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="nombre">
                            Nombre <p-sortIcon field="nombre"></p-sortIcon>
                        </th>
                        <th style="width: 15%">Estado</th>
                        <th style="width: 12rem">Acciones</th>
                    </tr>
                </ng-template>
                
                <ng-template pTemplate="body" let-tipo>
                    <tr>
                        <td>
                            <div class="flex align-items-center">
                                <i class="pi pi-wrench mr-2 text-500"></i>
                                <span class="font-medium">{{ tipo.nombre }}</span>
                            </div>
                        </td>
                        <td>
                            <p-tag [value]="tipo.estado ? 'Activo' : 'Inactivo'" 
                                   [severity]="tipo.estado ? 'success' : 'danger'"
                                   [rounded]="true"></p-tag>
                        </td>
                        <td>
                            <div class="flex gap-1">
                                <button pButton pRipple 
                                        icon="pi pi-pencil" 
                                        class="p-button-rounded p-button-text p-button-warning" 
                                        (click)="editTipo(tipo)" 
                                        pTooltip="Editar"
                                        tooltipPosition="top"></button>
                                <button pButton pRipple 
                                        icon="pi pi-trash" 
                                        class="p-button-rounded p-button-text p-button-danger" 
                                        (click)="deleteTipo(tipo)" 
                                        pTooltip="Eliminar"
                                        tooltipPosition="top"></button>
                            </div>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="4" class="text-center p-5">
                            <div class="flex flex-column align-items-center">
                                <i class="pi pi-inbox text-4xl text-400 mb-3"></i>
                                <span class="text-600 text-lg">No hay tipos de mantenimiento registrados</span>
                                <button pButton pRipple label="Crear Primer Tipo" icon="pi pi-plus" 
                                        class="p-button-sm mt-3"
                                        (click)="showCreateDialog()"></button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>

<!-- Diálogo para crear/editar tipo -->
<p-dialog [header]="isEditing ? 'Editar Tipo de Mantenimiento' : 'Nuevo Tipo de Mantenimiento'" 
          [(visible)]="displayDialog" 
          [modal]="true"
          [style]="{width: '550px'}"
          [maximizable]="false"
          [draggable]="false"
          [resizable]="false"
          styleClass="p-fluid"
          (onHide)="hideDialog()">
    
    <ng-template pTemplate="content">
        <form [formGroup]="tipoForm">
            <!-- Información general -->
            <div class="surface-section px-3 py-2 mb-4 border-round">
                <div class="flex align-items-center mb-2">
                    <i class="pi pi-info-circle text-primary mr-2"></i>
                    <span class="font-semibold text-900">Información del Tipo</span>
                </div>
                <p class="text-600 text-sm m-0">
                    Define un tipo de mantenimiento que se podrá asignar a equipos.
                </p>
            </div>

            <div class="grid">
                <!-- Nombre -->
                <div class="col-12">
                    <label for="nombre" class="block font-medium mb-2">
                        Nombre <span class="text-red-500">*</span>
                    </label>
                    <div class="p-inputgroup">
                        <span class="p-inputgroup-addon">
                            <i class="pi pi-wrench"></i>
                        </span>
                        <input id="nombre" 
                               type="text" 
                               pInputText 
                               formControlName="nombre" 
                               placeholder="Mantenimiento Preventivo" 
                               maxlength="50" 
                               [class.ng-invalid]="tipoForm.get('nombre')?.invalid && tipoForm.get('nombre')?.touched" />
                    </div>
                    <small class="block mt-1 text-500">
                        <i class="pi pi-info-circle text-xs mr-1"></i>
                        El código se generará automáticamente
                    </small>
                    <small class="block p-error mt-1" *ngIf="getFieldError('nombre')">
                        <i class="pi pi-times-circle mr-1"></i>
                        {{ getFieldError('nombre') }}
                    </small>
                </div>

                <!-- Estado -->
                <div class="col-12">
                    <div class="surface-50 border-round p-3">
                        <div class="flex align-items-center">
                            <p-checkbox formControlName="estado" 
                                       binary="true" 
                                       inputId="estado"
                                       styleClass="mr-2"></p-checkbox>
                            <label for="estado" class="cursor-pointer flex-1">
                                <div class="flex align-items-center">
                                    <i class="pi pi-check-circle text-green-500 mr-2" *ngIf="tipoForm.get('estado')?.value"></i>
                                    <i class="pi pi-times-circle text-red-500 mr-2" *ngIf="!tipoForm.get('estado')?.value"></i>
                                    <div>
                                        <div class="font-semibold" [class.text-green-700]="tipoForm.get('estado')?.value" [class.text-500]="!tipoForm.get('estado')?.value">
                                            {{ tipoForm.get('estado')?.value ? 'Tipo Activo' : 'Tipo Inactivo' }}
                                        </div>
                                        <div class="text-sm text-600">
                                            {{ tipoForm.get('estado')?.value ? 'Disponible para asignar a equipos' : 'No se podrá asignar a equipos' }}
                                        </div>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </ng-template>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-between align-items-center w-full">
            <small class="text-500">
                <i class="pi pi-info-circle mr-1"></i>
                Los campos con * son obligatorios
            </small>
            <div class="flex gap-2">
                <button pButton 
                        type="button" 
                        label="Cancelar" 
                        icon="pi pi-times" 
                        class="p-button-text p-button-secondary" 
                        (click)="hideDialog()"></button>
                <button pButton 
                        type="submit" 
                        [label]="isEditing ? 'Actualizar' : 'Crear'" 
                        [icon]="isEditing ? 'pi pi-check' : 'pi pi-plus'" 
                        [disabled]="tipoForm.invalid" 
                        (click)="saveTipo()"></button>
            </div>
        </div>
    </ng-template>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
