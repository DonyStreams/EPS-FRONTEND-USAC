<div class="grid">
    <!-- Título y descripción -->
    <div class="col-12">
        <div class="card">
            <div class="flex align-items-center justify-content-between mb-3">
                <div>
                    <h4 class="m-0 flex align-items-center gap-2">
                        <i class="pi pi-building text-primary"></i>
                        Gestión de Proveedores
                    </h4>
                    <p class="text-500 mt-1 mb-0">Administre los proveedores de mantenimiento y servicios.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Estadísticas (3 cards principales) -->
    <div class="col-12 md:col-4">
        <div class="surface-card shadow-1 border-round p-3">
            <div class="flex align-items-center">
                <div class="bg-blue-100 border-circle p-3 mr-3">
                    <i class="pi pi-users text-blue-500 text-2xl"></i>
                </div>
                <div>
                    <span class="text-600 text-sm">Total Proveedores</span>
                    <div class="text-900 font-bold text-2xl">{{ totalProveedores }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-12 md:col-4">
        <div class="surface-card shadow-1 border-round p-3">
            <div class="flex align-items-center">
                <div class="bg-green-100 border-circle p-3 mr-3">
                    <i class="pi pi-check-circle text-green-500 text-2xl"></i>
                </div>
                <div>
                    <span class="text-600 text-sm">Activos</span>
                    <div class="text-900 font-bold text-2xl">{{ proveedoresActivos }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-12 md:col-4">
        <div class="surface-card shadow-1 border-round p-3">
            <div class="flex align-items-center">
                <div class="bg-red-100 border-circle p-3 mr-3">
                    <i class="pi pi-times-circle text-red-500 text-2xl"></i>
                </div>
                <div>
                    <span class="text-600 text-sm">Inactivos</span>
                    <div class="text-900 font-bold text-2xl">{{ proveedoresInactivos }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla principal -->
    <div class="col-12">
        <div class="card">
            <!-- Barra de acciones moderna -->
            <div class="surface-ground border-round p-3 mb-4">
                <div class="flex flex-column md:flex-row md:align-items-center md:justify-content-between gap-3">
                    <div class="flex gap-2">
                        <button pButton pRipple label="Nuevo Proveedor" icon="pi pi-plus" 
                                class="p-button-success"
                                (click)="showCreateDialog()"></button>
                    </div>
                    
                    <span class="p-input-icon-left w-full md:w-auto">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" 
                               (input)="dt.filterGlobal($any($event.target).value, 'contains')" 
                               placeholder="Buscar proveedor..." 
                               class="w-full md:w-20rem" />
                    </span>
                </div>
            </div>

            <!-- Tabla mejorada -->
            <p-table [value]="proveedores" 
                     [loading]="loading" 
                     [paginator]="true" 
                     [rows]="10" 
                     [rowsPerPageOptions]="[10,20,30]"
                     [showCurrentPageReport]="true"
                     currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} proveedores"
                     [globalFilterFields]="['nit','nombre']"
                     [rowHover]="true"
                     styleClass="p-datatable-sm"
                     #dt>

                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="idProveedor" style="width: 8%">
                            ID <p-sortIcon field="idProveedor"></p-sortIcon>
                        </th>
                        <th pSortableColumn="nit" style="width: 15%">
                            NIT <p-sortIcon field="nit"></p-sortIcon>
                        </th>
                        <th pSortableColumn="nombre">
                            Nombre <p-sortIcon field="nombre"></p-sortIcon>
                        </th>
                        <th style="width: 15%">Estado</th>
                        <th style="width: 12rem">Acciones</th>
                    </tr>
                </ng-template>
                
                <ng-template pTemplate="body" let-proveedor>
                    <tr>
                        <td>
                            <span class="font-bold text-purple-500">#{{ proveedor.idProveedor }}</span>
                        </td>
                        <td>
                            <span class="font-mono font-bold text-600">{{ proveedor.nit }}</span>
                        </td>
                        <td>
                            <div class="flex align-items-center">
                                <i class="pi pi-building mr-2 text-500"></i>
                                <span class="font-medium">{{ proveedor.nombre }}</span>
                            </div>
                        </td>
                        <td>
                            <p-tag [value]="proveedor.estado ? 'Activo' : 'Inactivo'" 
                                   [severity]="proveedor.estado ? 'success' : 'danger'"
                                   [rounded]="true"></p-tag>
                        </td>
                        <td>
                            <div class="flex gap-1">
                                <button pButton pRipple 
                                        icon="pi pi-pencil" 
                                        class="p-button-rounded p-button-text p-button-warning" 
                                        (click)="editProveedor(proveedor)" 
                                        pTooltip="Editar"
                                        tooltipPosition="top"></button>
                                <button pButton pRipple 
                                        icon="pi pi-trash" 
                                        class="p-button-rounded p-button-text p-button-danger" 
                                        (click)="deleteProveedor(proveedor)" 
                                        pTooltip="Eliminar"
                                        tooltipPosition="top"></button>
                            </div>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5" class="text-center p-5">
                            <div class="flex flex-column align-items-center">
                                <i class="pi pi-inbox text-4xl text-400 mb-3"></i>
                                <span class="text-600 text-lg">No hay proveedores registrados</span>
                                <button pButton pRipple label="Crear Primer Proveedor" icon="pi pi-plus" 
                                        class="p-button-sm mt-3"
                                        (click)="showCreateDialog()"></button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>

<!-- Diálogo para crear/editar proveedor -->
<p-dialog header="{{ isEditing ? 'Editar' : 'Nuevo' }} Proveedor" 
          [(visible)]="displayDialog" 
          [modal]="true" 
          [responsive]="true" 
          [style]="{width: '450px'}"
          (onHide)="hideDialog()">
    
    <form [formGroup]="proveedorForm" (ngSubmit)="saveProveedor()">
        <div class="grid p-fluid">
            <div class="col-12">
                <label for="nit" class="block text-900 font-medium mb-2">NIT *</label>
                <input id="nit" type="text" pInputText formControlName="nit" 
                       placeholder="Ej: 123456789-K" maxlength="20" 
                       [class.ng-invalid]="proveedorForm.get('nit')?.invalid && proveedorForm.get('nit')?.touched" />
                <small class="p-error" *ngIf="getFieldError('nit')">
                    {{ getFieldError('nit') }}
                </small>
            </div>

            <div class="col-12">
                <label for="nombre" class="block text-900 font-medium mb-2">Nombre *</label>
                <input id="nombre" type="text" pInputText formControlName="nombre" 
                       placeholder="Ej: Empresa de Mantenimiento S.A." maxlength="100" 
                       [class.ng-invalid]="proveedorForm.get('nombre')?.invalid && proveedorForm.get('nombre')?.touched" />
                <small class="p-error" *ngIf="getFieldError('nombre')">
                    {{ getFieldError('nombre') }}
                </small>
            </div>

            <div class="col-12">
                <div class="field-checkbox">
                    <p-checkbox formControlName="estado" binary="true" inputId="estado"></p-checkbox>
                    <label for="estado" class="ml-2">Activo</label>
                </div>
            </div>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <button pButton type="button" label="Cancelar" icon="pi pi-times" 
                class="p-button-text" (click)="hideDialog()"></button>
        <button pButton type="submit" label="Guardar" icon="pi pi-check" 
                [disabled]="proveedorForm.invalid" (click)="saveProveedor()"></button>
    </ng-template>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
